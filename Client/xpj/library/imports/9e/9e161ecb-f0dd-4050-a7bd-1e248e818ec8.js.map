{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\SceneScript\\Home/assets\\Script\\SceneScript\\Home\\Exchange.ts"],"names":[],"mappings":";;;;;AACA,kDAAoD;AAE9C,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAAQ,CAAmB;AAG5C;IAAsC,4BAAY;IADlD;QAAA,qEAuJC;QApJG,gBAAU,GAAY,IAAI,CAAC;QAG3B,gBAAU,GAAY,IAAI,CAAC;QAG3B,cAAQ,GAAgB,IAAI,CAAC;QAG7B,aAAO,GAAe,IAAI,CAAC;QAE3B;;;;UAIE;QAEF,cAAQ,GAAa,IAAI,CAAC;QAE1B,YAAM,GAAW,CAAC,CAAC;;IAiIvB,CAAC;IAhIG,yBAAM,GAAN;QAAA,iBAWC;QAVG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,UAAU,EAAE,UAAC,KAA0B;YAChD,KAAK,CAAC,eAAe,EAAE,CAAC;YACxB,EAAE,CAAC,UAAU,CAAC,WAAW,GAAG,IAAI,CAAC;YACjC,KAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;YACjC,KAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;QACxB,CAAC,EAAE,IAAI,CAAC,CAAC;QACT,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,KAAK,CAAC;QAC/B,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,KAAK,CAAC;QAC/B,EAAE,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC;QAC5B,IAAI,CAAC,YAAY,EAAE,CAAC;IACxB,CAAC;IACD,2BAAQ,GAAR,UAAS,IAAI;QACT,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC;QACjC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,aAAa,GAAG,UAAU,CAAC;IACpE,CAAC;IACD;;;OAGG;IACH,+BAAY,GAAZ,UAAa,IAAI;QACb,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YACP,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,IAAI,CAAC;YAC9B,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,KAAK,CAAC;YAC/B,IAAI,QAAQ,GAAG,EAAE,CAAC;YAClB,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;gBACnC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;oBACR,QAAQ,IAAI,UAAU,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC;gBACjE,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;wBAClB,QAAQ,IAAI,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC;oBAC5D,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACJ,QAAQ,IAAI,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC;oBACzC,CAAC;gBACL,CAAC;YACL,CAAC;YACD,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,QAAQ,CAAC;QACpC,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,KAAK,CAAC;YAC/B,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,IAAI,CAAC;QAClC,CAAC;IACL,CAAC;IACD;;;OAGG;IACH,+BAAY,GAAZ;QAAA,iBAaC;QAZG,EAAE,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;YAC9B,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC,QAAQ,CAAC,gCAAgC,EAAE,EAAE,EAAE,UAAC,IAAY,EAAE,OAAa;gBAChG,EAAE,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC;gBAC5B,EAAE,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC;oBACb,KAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;gBAC/B,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;oBACrB,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;gBACnC,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;gBACnC,CAAC;YACL,CAAC,CAAC,CAAC;QACP,CAAC;IACL,CAAC;IACD;;;;OAIG;IACH,8BAAW,GAAX,UAAY,KAAa;QAAzB,iBAeC;QAdG,EAAE,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;YAC9B,IAAI,GAAG,GAAG,EAAE,WAAW,EAAE,KAAK,EAAE,CAAC;YACjC,IAAI,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;YAC9B,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC,QAAQ,CAAC,0BAA0B,EAAE,GAAG,EAAE,UAAC,IAAY,EAAE,OAAa;gBAC3F,EAAE,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC;gBAC5B,EAAE,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC;oBACb,KAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;gBAC/B,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;oBACrB,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;gBACnC,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;gBACnC,CAAC;YACL,CAAC,CAAC,CAAC;QACP,CAAC;IACL,CAAC;IAED;;;OAGG;IACH,8BAAW,GAAX,UAAY,QAAgB,EAAE,OAAmB;QAC7C,SAAS;QACT,EAAE,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;YAC1B,EAAE,CAAC,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBACtB,QAAQ,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,EAAE,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;gBACtD,OAAO,CAAC,MAAM,GAAG,QAAQ,CAAC;YAC9B,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,OAAO,CAAC,MAAM,GAAG,EAAE,CAAC;YACxB,CAAC;QACL,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,IAAI,KAAK,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC;YAC7B,OAAO,CAAC,MAAM,GAAG,KAAK,GAAG,EAAE,CAAC;QAChC,CAAC;IACL,CAAC;IACD;;;OAGG;IACH,qCAAkB,GAAlB;QACI,EAAE,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC;QAC3B,IAAI,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;QAC1C,EAAE,CAAC,CAAC,QAAQ,KAAK,EAAE,IAAI,QAAQ,KAAK,IAAI,CAAC,CAAC,CAAC;YACvC,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;YACjC,MAAM,CAAC;QACX,CAAC;QACD,IAAI,KAAK,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC;QAC7B,EAAE,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACf,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,EAAE,CAAC;YACzB,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;YACpC,MAAM,CAAC;QACX,CAAC;QACD,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC;YAC9B,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,EAAE,CAAC;YACzB,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;YACpC,MAAM,CAAC;QACX,CAAC;QACD,EAAE,CAAC,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;YAC5B,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;YACvC,MAAM,CAAC;QACX,CAAC;QACD,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;IAC5B,CAAC;IAnJD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;gDACS;IAG3B;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;gDACS;IAG3B;QADC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC;8CACO;IAG7B;QADC,QAAQ,CAAC,EAAE,CAAC,OAAO,CAAC;6CACM;IAQ3B;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;8CACO;IAnBT,QAAQ;QAD5B,OAAO;OACa,QAAQ,CAsJ5B;IAAD,eAAC;CAtJD,AAsJC,CAtJqC,EAAE,CAAC,SAAS,GAsJjD;kBAtJoB,QAAQ","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\SceneScript\\Home","sourcesContent":["\r\nimport * as dd from './../../Modules/ModuleManager';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Exchange extends cc.Component {\r\n    @property(cc.Node)\r\n    node_input: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    node_order: cc.Node = null;\r\n\r\n    @property(cc.RichText)\r\n    lblOrder: cc.RichText = null;\r\n\r\n    @property(cc.EditBox)\r\n    edit_dh: cc.EditBox = null;\r\n\r\n    /**\r\n    * 充值比例\r\n    * @type {cc.Label}\r\n    * @memberof Recharge\r\n    */\r\n    @property(cc.Label)\r\n    lblRatio: cc.Label = null;\r\n\r\n    _ratio: number = 0;\r\n    onLoad() {\r\n        this.node.on(\"touchend\", (event: cc.Event.EventTouch) => {\r\n            event.stopPropagation();\r\n            dd.ui_manager.isShowPopup = true;\r\n            this.node.removeFromParent(true);\r\n            this.node.destroy();\r\n        }, this);\r\n        this.node_order.active = false;\r\n        this.node_input.active = false;\r\n        dd.ui_manager.hideLoading();\r\n        this.getOrderInfo();\r\n    }\r\n    initData(data) {\r\n        this._ratio = data.goldMoney2Rmb;\r\n        this.lblRatio.string = '兑换比例' + data.goldMoney2Rmb + '金币 = 1礼券';\r\n    }\r\n    /**\r\n     * 显示兑换信息\r\n     * @memberof Exchange\r\n     */\r\n    showExchange(data) {\r\n        if (data) {\r\n            this.node_order.active = true;\r\n            this.node_input.active = false;\r\n            let orderStr = '';\r\n            for (var i = 0; i < data.length; i++) {\r\n                if (i > 1) {\r\n                    orderStr += '<br/>订单号' + (i + 1) + ':<b>' + data[i] + '<b/>';\r\n                } else {\r\n                    if (data.length > 1) {\r\n                        orderStr += '订单号' + (i + 1) + ':<b>' + data[i] + '<b/>';\r\n                    } else {\r\n                        orderStr += '<b>' + data[i] + '<b/>';\r\n                    }\r\n                }\r\n            }\r\n            this.lblOrder.string = orderStr;\r\n        } else {\r\n            this.node_order.active = false;\r\n            this.node_input.active = true;\r\n        }\r\n    }\r\n    /**\r\n     * 获取兑换订单号信息\r\n     * @memberof Recharge\r\n     */\r\n    getOrderInfo() {\r\n        if (dd.ui_manager.showLoading()) {\r\n            dd.ws_manager.sendMsg(dd.protocol.ORDER_CHARGE_GOLDMONEY2RMB_QUERY, '', (flag: number, content?: any) => {\r\n                dd.ui_manager.hideLoading();\r\n                if (flag === 0) {//成功\r\n                    this.showExchange(content);\r\n                } else if (flag === -1) {//超时\r\n                    dd.ui_manager.showTip('消息超时!');\r\n                } else {//失败,content是一个字符串\r\n                    dd.ui_manager.showTip(content);\r\n                }\r\n            });\r\n        }\r\n    }\r\n    /**\r\n     * 兑换\r\n     * @param {number} money \r\n     * @memberof Exchange\r\n     */\r\n    getExchange(money: number) {\r\n        if (dd.ui_manager.showLoading()) {\r\n            let obj = { 'goldMoney': money };\r\n            let msg = JSON.stringify(obj);\r\n            dd.ws_manager.sendMsg(dd.protocol.ORDER_CHARGE_GOLDMONEY2RMB, msg, (flag: number, content?: any) => {\r\n                dd.ui_manager.hideLoading();\r\n                if (flag === 0) {//成功\r\n                    this.showExchange(content);\r\n                } else if (flag === -1) {//超时\r\n                    dd.ui_manager.showTip('消息超时!');\r\n                } else {//失败,content是一个字符串\r\n                    dd.ui_manager.showTip(content);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @memberof Recharge\r\n     */\r\n    edit_change(inputStr: string, editBox: cc.EditBox) {\r\n        //如果是特殊符号\r\n        if (isNaN(Number(inputStr))) {\r\n            if (inputStr.length > 1) {\r\n                inputStr = inputStr.substring(0, inputStr.length - 1);\r\n                editBox.string = inputStr;\r\n            } else {\r\n                editBox.string = '';\r\n            }\r\n        } else {\r\n            let money = Number(inputStr);\r\n            editBox.string = money + '';\r\n        }\r\n    }\r\n    /**\r\n     * 兑换按钮\r\n     * @memberof Exchange\r\n     */\r\n    click_btn_exchange() {\r\n        dd.mp_manager.playButton();\r\n        let moneyStr = this.edit_dh.string.trim();\r\n        if (moneyStr === '' || moneyStr === null) {\r\n            dd.ui_manager.showTip('兑换金额不为空');\r\n            return;\r\n        }\r\n        let money = Number(moneyStr);\r\n        if (isNaN(money)) {\r\n            this.edit_dh.string = '';\r\n            dd.ui_manager.showTip('请输入有效的兑换金额');\r\n            return;\r\n        }\r\n        if (Math.floor(money) !== money) {\r\n            this.edit_dh.string = '';\r\n            dd.ui_manager.showTip('请输入整数的兑换金额');\r\n            return;\r\n        }\r\n        if (money % this._ratio !== 0) {\r\n            dd.ui_manager.showTip('请输入兑换比例的整数倍金币');\r\n            return;\r\n        }\r\n        this.getExchange(money);\r\n    }\r\n}\r\n"]}