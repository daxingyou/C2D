{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Modules/assets\\Script\\Modules\\MPManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Modules","sourcesContent":["/**\r\n * 音频管理类\r\n * \r\n * @export\r\n * @class MPManager\r\n */\r\nexport default class MPManager {\r\n    private static _instance: MPManager = null;\r\n    private constructor() { }\r\n    /**\r\n     * 获取WSManager单例对象\r\n     * \r\n     * @static\r\n     * @returns {MPManager} \r\n     * @memberof MPManager\r\n     */\r\n    static getInstance(): MPManager {\r\n        if (MPManager._instance === null) {\r\n            MPManager._instance = new MPManager();\r\n        }\r\n        return MPManager._instance;\r\n    }\r\n    /**\r\n     * 音频配置对象\r\n     * \r\n     * @type {audioSetting}\r\n     * @memberof MPManager\r\n     */\r\n    audioSetting: audioSetting = null;\r\n    /**\r\n     * 背景音乐播放的id\r\n     * \r\n     * @private\r\n     * @type {number}\r\n     * @memberof MPManager\r\n     */\r\n    private backgroundID: number = null;\r\n\r\n    /**\r\n     * 播放音效的id(警告,按钮,弹出框)\r\n     * \r\n     * @private\r\n     * @type {number}\r\n     * @memberof MPManager\r\n     */\r\n    private effectID: number = null;\r\n\r\n    /**\r\n     * 初始化音频管理\r\n     * \r\n     * @returns \r\n     * @memberof MPManager\r\n     */\r\n    initMP() {\r\n        this.initSetting();\r\n        this.playBackGround();\r\n    }\r\n    /**\r\n     * 加载音频文件\r\n     * \r\n     * @private\r\n     * @param {string} path 音频路径(不带扩展名)\r\n     * @returns {Promise<string>} 返回音频可用播放的路径\r\n     * @memberof MPManager\r\n     */\r\n    private loadFile(path: string): Promise<string> {\r\n        return new Promise<string>((resolve, reject) => {\r\n            cc.loader.loadRes(path, (error: Error, resource: any) => {\r\n                if (error) {\r\n                    cc.error(error.message || error);\r\n                    reject(error.message || error);\r\n                }\r\n                resolve(resource);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 初始化音频配置\r\n     * \r\n     * @memberof MPManager\r\n     */\r\n    private initSetting(): void {\r\n        let db = cc.sys.localStorage;\r\n        let audioStr = db.getItem('audioSetting');\r\n        if (audioStr) {\r\n            this.audioSetting = JSON.parse(audioStr);\r\n        } else {\r\n            this.audioSetting = {\r\n                isMusic: true,\r\n                isEffect: true\r\n            }\r\n            db.setItem('audioSetting', JSON.stringify(this.audioSetting));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 保存音频配置\r\n     * \r\n     * @memberof MPManager\r\n     */\r\n    saveMPSetting(): void {\r\n        let db = cc.sys.localStorage;\r\n        db.setItem('audioSetting', JSON.stringify(this.audioSetting));\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * 播放背景音乐\r\n     * \r\n     * @returns \r\n     * @memberof MPManager\r\n     */\r\n    async playBackGround() {\r\n        if (this.backgroundID !== null || !this.audioSetting.isMusic) return;\r\n        let path = await this.loadFile('Audio/music');\r\n        this.backgroundID = cc.audioEngine.play(path, true, 1);\r\n    }\r\n\r\n    /**\r\n     * 停止背景音乐\r\n     * \r\n     * @memberof MPManager\r\n     */\r\n    stopBackGround(): void {\r\n        if (this.backgroundID !== null) {\r\n            cc.audioEngine.stop(this.backgroundID);\r\n            this.backgroundID = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 停止正在播放的音效\r\n     * \r\n     * @private\r\n     * @memberof MPManager\r\n     */\r\n    private stopEffect() {\r\n        if (this.effectID) {\r\n            cc.audioEngine.stop(this.effectID);\r\n            this.effectID = null;\r\n        }\r\n    }\r\n    /**\r\n     * 音效播放完毕的回调\r\n     * \r\n     * @private\r\n     * @memberof MPManager\r\n     */\r\n    private finish(callback?: Function) {\r\n        cc.audioEngine.setFinishCallback(this.effectID, () => {\r\n            this.effectID = null;\r\n            if (callback) {\r\n                callback();\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * 播放按钮音\r\n     * \r\n     * @memberof MPManager\r\n     */\r\n    async playButton() {\r\n        if (this.audioSetting.isEffect) {\r\n            this.stopEffect();\r\n            let paht = await this.loadFile('Audio/click');\r\n            this.effectID = cc.audioEngine.play(paht, false, 1);\r\n            this.finish();\r\n        }\r\n    }\r\n    /**\r\n     * 播放发牌音效\r\n     * \r\n     * @memberof MPManager\r\n     */\r\n    async playFaPai() {\r\n        if (this.audioSetting.isEffect) {\r\n            this.stopEffect();\r\n            let paht = await this.loadFile('Audio/fapai');\r\n            this.effectID = cc.audioEngine.play(paht, false, 1);\r\n            this.finish();\r\n        }\r\n    }\r\n    /**\r\n     * 播放飞金币音效\r\n     * \r\n     * @memberof MPManager\r\n     */\r\n    async playCoinMove() {\r\n        if (this.audioSetting.isEffect) {\r\n            this.stopEffect();\r\n            let paht = await this.loadFile('Audio/coinmove');\r\n            this.effectID = cc.audioEngine.play(paht, false, 1);\r\n            this.finish();\r\n        }\r\n    }\r\n    /**\r\n     * 播放胜利音效\r\n     * \r\n     * @memberof MPManager\r\n     */\r\n    async playWin() {\r\n        if (this.audioSetting.isEffect) {\r\n            this.stopEffect();\r\n            let paht = await this.loadFile('Audio/win');\r\n            this.effectID = cc.audioEngine.play(paht, false, 1);\r\n            this.finish();\r\n        }\r\n    }\r\n    /**\r\n     * 播放失败音效\r\n     * \r\n     * @memberof MPManager\r\n     */\r\n    async playLose() {\r\n        if (this.audioSetting.isEffect) {\r\n            this.stopEffect();\r\n            let paht = await this.loadFile('Audio/lose');\r\n            this.effectID = cc.audioEngine.play(paht, false, 1);\r\n            this.finish();\r\n        }\r\n    }\r\n    /**\r\n     * 播放游戏开始音效\r\n     * \r\n     * @memberof MPManager\r\n     */\r\n    async playStart(callback?: Function) {\r\n        if (this.audioSetting.isEffect) {\r\n            this.stopEffect();\r\n            let paht = await this.loadFile('Audio/start');\r\n            this.effectID = cc.audioEngine.play(paht, false, 1);\r\n            this.finish(callback);\r\n        }\r\n    }\r\n    /**\r\n     * 播放倒计时音效\r\n     * \r\n     * @memberof MPManager\r\n     */\r\n    async playTime() {\r\n        if (this.audioSetting.isEffect) {\r\n            this.stopEffect();\r\n            let paht = await this.loadFile('Audio/time');\r\n            this.effectID = cc.audioEngine.play(paht, false, 1);\r\n            this.finish();\r\n        }\r\n    }\r\n    /**\r\n     * 播放炸金花的音效\r\n     * \r\n     * @param {string} name \r\n     * @memberof MPManager\r\n     */\r\n    async playZJH(name: string, callback?: Function) {\r\n        if (this.audioSetting.isEffect) {\r\n            // this.stopEffect();\r\n            let paht = await this.loadFile('Audio/zjh/' + name);\r\n            this.effectID = cc.audioEngine.play(paht, false, 1);\r\n            this.finish(callback);\r\n        }\r\n    }\r\n    /**\r\n     * 播放牛牛的音效\r\n     * \r\n     * @param {string} name \r\n     * @memberof MPManager\r\n     */\r\n    async playNN(name: string, callback?: Function) {\r\n        if (this.audioSetting.isEffect) {\r\n            this.stopEffect();\r\n            let paht = await this.loadFile('Audio/nn/' + name);\r\n            this.effectID = cc.audioEngine.play(paht, false, 1);\r\n            this.finish(callback);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 释放销毁\r\n     * \r\n     * @memberof MPManager\r\n     */\r\n    destroySelf(): void {\r\n        cc.audioEngine.uncacheAll();\r\n        this.effectID = null;\r\n        this.backgroundID = null;\r\n        this.audioSetting = null;\r\n    }\r\n}"]}