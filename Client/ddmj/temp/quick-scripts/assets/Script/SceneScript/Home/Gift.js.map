{"version":3,"sources":["Gift.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\SceneScript\\Home","sourcesContent":["import * as dd from './../../Modules/ModuleManager';\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Gift extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    node_board1: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    node_board2: cc.Node = null;\r\n\r\n    @property(cc.ScrollView)\r\n    svNode: cc.ScrollView = null;\r\n\r\n    @property(cc.Prefab)\r\n    gift_item_prefab: cc.Prefab = null;\r\n\r\n    /**\r\n     * 输入数量\r\n     * \r\n     * @type {cc.EditBox}\r\n     * @memberof Gift\r\n     */\r\n    @property(cc.EditBox)\r\n    edit_giftNum: cc.EditBox = null;\r\n    /**\r\n     * 输入id\r\n     * \r\n     * @type {cc.EditBox}\r\n     * @memberof Gift\r\n     */\r\n    @property(cc.EditBox)\r\n    edit_id: cc.EditBox = null;\r\n\r\n    /**\r\n     * 赠送玩家头像\r\n     * \r\n     * @type {cc.Sprite}\r\n     * @memberof Gift\r\n     */\r\n    @property(cc.Sprite)\r\n    headImg: cc.Sprite = null;\r\n    /**\r\n     * 赠送玩家昵称\r\n     * \r\n     * @type {cc.Label}\r\n     * @memberof Gift\r\n     */\r\n    @property(cc.Label)\r\n    lblName: cc.Label = null;\r\n    /**\r\n     * 赠送玩家id\r\n     * \r\n     * @type {cc.Label}\r\n     * @memberof Gift\r\n     */\r\n    @property(cc.Label)\r\n    lblID: cc.Label = null;\r\n    /**\r\n     * 赠送玩家数量\r\n     * \r\n     * @type {cc.Label}\r\n     * @memberof Gift\r\n     */\r\n    @property(cc.Label)\r\n    lblGiftNum: cc.Label = null;\r\n    onLoad() {\r\n        this.node.on('touchend', (event) => {\r\n            dd.ui_manager.isShowPopup = true;\r\n            this.node.removeFromParent(true);\r\n            this.node.destroy();\r\n            event.stopPropagation();\r\n        }, this);\r\n        this.showGiftLayer(0);\r\n    }\r\n\r\n    /**\r\n     * 获取赠送记录\r\n     * \r\n     * @memberof Gift\r\n     */\r\n    sendGetRecordList() {\r\n        dd.ui_manager.hideLoading();\r\n        if (dd.ui_manager.showLoading()) {\r\n            this.svNode.content.removeAllChildren();\r\n            // let obj = {  };\r\n            // let msg = JSON.stringify(obj);\r\n            dd.ws_manager.sendMsg(dd.protocol.WALLET_ROOMCARD_RECORD, '', (flag: number, content?: any) => {\r\n                if (flag === 0) {//成功\r\n                    this.showRecordList(content.items as WalletGiveInner[]);\r\n                } else if (flag === -1) {//超时\r\n                } else {//失败,content是一个字符串\r\n                    dd.ui_manager.showAlert(content, '温馨提示');\r\n                }\r\n                dd.ui_manager.hideLoading();\r\n                cc.log(content);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 赠送房卡\r\n     * \r\n     * @memberof Gift\r\n     */\r\n    sendGiveGift(givePlayer: string, giveNum: string) {\r\n        if (dd.ui_manager.showLoading()) {\r\n            let obj = { 'givePlayer': givePlayer, 'giveNum': giveNum };\r\n            let msg = JSON.stringify(obj);\r\n            dd.ws_manager.sendMsg(dd.protocol.WALLET_ROOMCARD_GIVE, msg, (flag: number, content?: any) => {\r\n                if (flag === 0) {//成功\r\n                    dd.ui_manager.showTip('赠送成功');\r\n                    dd.ui_manager.isShowPopup = true;\r\n                    this.node.removeFromParent(true);\r\n                    this.node.destroy();\r\n                } else if (flag === -1) {//超时\r\n                } else {//失败,content是一个字符串\r\n                    this.showGiftLayer(0);\r\n                    dd.ui_manager.showTip(content);\r\n                }\r\n                dd.ui_manager.hideLoading();\r\n                cc.log(content);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取玩家信息\r\n     * \r\n     * @param {string} starNO \r\n     * @memberof Gift\r\n     */\r\n    sendGetRoleInfo(starNO: string, giftNum: string) {\r\n        if (dd.ui_manager.showLoading()) {\r\n            dd.mp_manager.playAlert();\r\n            let obj = { 'starNO': starNO };\r\n            let msg = JSON.stringify(obj);\r\n            dd.ws_manager.sendMsg(dd.protocol.ACCOUNT_ROLE_STARNO, msg, (flag: number, content?: any) => {\r\n                if (flag === 0) {//成功\r\n                    let roleInfo = content as UserData;\r\n                    this.showRoleInfo(roleInfo, giftNum);\r\n                    this.showGiftLayer(1);\r\n                } else if (flag === -1) {//超时\r\n                } else {//失败,content是一个字符串\r\n                    dd.ui_manager.showTip(content, 0.5, 1, 0.5);\r\n                }\r\n                dd.ui_manager.hideLoading();\r\n            });\r\n        }\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * 显示玩家信息\r\n     * \r\n     * @param {UserData} data \r\n     * @memberof Gift\r\n     */\r\n    async showRoleInfo(data: UserData, giftNum: string) {\r\n        this.lblName.string = data.nick;\r\n        this.lblID.string = data.starNO;\r\n        this.lblGiftNum.string = giftNum;\r\n        let headSF = null;\r\n        try {\r\n            headSF = await dd.img_manager.loadURLImage(data.headImg);\r\n        } catch (error) {\r\n            cc.log('获取头像错误');\r\n        }\r\n        this.headImg.spriteFrame = headSF;\r\n    }\r\n\r\n    /**\r\n     * 显示赠送界面 0=输入界面 1=确定赠送界面\r\n     * \r\n     * @param {number} [type=0] \r\n     * @memberof Gift\r\n     */\r\n    showGiftLayer(type: number = 0) {\r\n        this.node_board1.active = type === 0 ? true : false;\r\n        this.node_board2.active = type === 1 ? true : false;\r\n        if (type === 0) {\r\n            this.sendGetRecordList();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 显示赠送列表\r\n     * \r\n     * @param {WalletGiveInner[]} data \r\n     * @memberof Gift\r\n     */\r\n    showRecordList(data: WalletGiveInner[]) {\r\n        if (!data) data = [];\r\n        this.svNode.content.removeAllChildren();\r\n        for (var i = 0; i < data.length; i++) {\r\n            let gift_item = cc.instantiate(this.gift_item_prefab);\r\n            let gift_item_script = gift_item.getComponent('Gift_Item');\r\n            gift_item_script.updateItem(i, data[i]);\r\n            gift_item.parent = this.svNode.content;\r\n        }\r\n    }\r\n    /**\r\n     * 赠送按钮\r\n     * \r\n     * @memberof Gift\r\n     */\r\n    click_btn_give() {\r\n        let idStr = this.edit_id.string.trim();\r\n        if (idStr === '') {\r\n            dd.ui_manager.showTip('ID不能为空');\r\n            return;\r\n        }\r\n        let numStr = this.edit_giftNum.string.trim();\r\n        if (numStr === '') {\r\n            dd.ui_manager.showTip('请输入赠送数量');\r\n            return;\r\n        }\r\n        if (Number(numStr) === 0) {\r\n            dd.ui_manager.showTip('赠送数量不能为0');\r\n            return;\r\n        }\r\n        this.sendGetRoleInfo(idStr, numStr);\r\n    }\r\n\r\n    /**\r\n     * 确定赠送\r\n     * \r\n     * @memberof Gift\r\n     */\r\n    click_btn_sure() {\r\n        this.sendGiveGift(this.lblID.string, this.lblGiftNum.string);\r\n    }\r\n    /**\r\n     * 取消赠送\r\n     * \r\n     * @memberof Gift\r\n     */\r\n    click_btn_cancel() {\r\n        this.showGiftLayer(0);\r\n    }\r\n\r\n    /**\r\n     * 退出\r\n     * \r\n     * @memberof Gift\r\n     */\r\n    click_btn_out() {\r\n        dd.ui_manager.isShowPopup = true;\r\n        this.node.removeFromParent(true);\r\n        this.node.destroy();\r\n    }\r\n}\r\n"]}