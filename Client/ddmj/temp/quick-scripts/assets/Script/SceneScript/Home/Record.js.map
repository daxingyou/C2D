{"version":3,"sources":["Record.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\SceneScript\\Home","sourcesContent":["const { ccclass, property } = cc._decorator;\r\nimport * as dd from './../../Modules/ModuleManager';\r\n\r\n@ccclass\r\nexport default class Record extends cc.Component {\r\n\r\n    /**\r\n     * 没有任何记录\r\n     * \r\n     * @type {cc.Node}\r\n     * @memberof Record\r\n     */\r\n    @property(cc.Node)\r\n    lblNoRecord: cc.Node = null;\r\n\r\n    /**\r\n     * \r\n     * 战绩界面\r\n     * @type {cc.Node}\r\n     * @memberof Record\r\n     */\r\n    @property(cc.Node)\r\n    node_record: cc.Node = null;\r\n\r\n    /**\r\n     * \r\n     * 详细战绩界面\r\n     * @type {cc.Node}\r\n     * @memberof Record\r\n     */\r\n    @property(cc.Node)\r\n    node_record_detail: cc.Node = null;\r\n\r\n    /**\r\n     * 桌子id\r\n     * \r\n     * @type {cc.Label}\r\n     * @memberof Record\r\n     */\r\n    @property(cc.Label)\r\n    lblRoomId: cc.Label = null;\r\n    /**\r\n     * 玩家列表\r\n     * \r\n     * @type {cc.Label[]}\r\n     * @memberof Record\r\n     */\r\n    @property([cc.Label])\r\n    lblNameList: cc.Label[] = [];\r\n    /**\r\n     * 俱乐部战绩列表\r\n     * \r\n     * @type {cc.ScrollView}\r\n     * @memberof Club\r\n     */\r\n    @property(cc.ScrollView)\r\n    svNode_record: cc.ScrollView = null;\r\n\r\n    /**\r\n     * 俱乐部战绩详细列表\r\n     * \r\n     * @type {cc.ScrollView}\r\n     * @memberof Club\r\n     */\r\n    @property(cc.ScrollView)\r\n    svNode_record_detail: cc.ScrollView = null;\r\n\r\n    /**\r\n     * 俱乐部记录预设\r\n     * \r\n     * @type {cc.Prefab}\r\n     * @memberof Club\r\n     */\r\n    @property(cc.Prefab)\r\n    club_record_item_prefab: cc.Prefab = null;\r\n\r\n    /**\r\n     * 俱乐部详细记录预设\r\n     * \r\n     * @type {cc.Prefab}\r\n     * @memberof Club\r\n     */\r\n    @property(cc.Prefab)\r\n    record_detail_item_prefab: cc.Prefab = null;\r\n    onLoad() {\r\n        this.node.on(\"touchend\", (event: cc.Event.EventTouch) => {\r\n            dd.ui_manager.isShowPopup = true;\r\n            this.node.removeFromParent(true);\r\n            this.node.destroy();\r\n            event.stopPropagation();\r\n        }, this);\r\n        dd.ui_manager.hideLoading();\r\n        this.lblNoRecord.active = true;\r\n        this.sendGetRecord();\r\n    }\r\n\r\n    /**\r\n     *查询战绩列表\r\n     * \r\n     * @memberof Room_Join_Club\r\n     */\r\n    sendGetRecord() {\r\n        this.node_record.active = true;\r\n        this.node_record_detail.active = false;\r\n        if (dd.ui_manager.showLoading()) {\r\n            let obj = { 'type': 1, 'query': dd.ud_manager.mineData.accountId };\r\n            let msg = JSON.stringify(obj);\r\n            dd.ws_manager.sendMsg(dd.protocol.REPLAY_QUERY_RECORD, msg, (flag: number, content?: any) => {\r\n                if (flag === 0) {//成功\r\n                    this.showRecordInfo(content as RecordVo);\r\n                } else if (flag === -1) {//超时\r\n                } else {//失败,content是一个字符串\r\n                    dd.ui_manager.showAlert(content, '温馨提示');\r\n                }\r\n                dd.ui_manager.hideLoading();\r\n                cc.log(content);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     *查询详细战绩数据\r\n     * \r\n     * @memberof Room_Join_Club\r\n     */\r\n    sendGetRecordDetailed(tableId: number) {\r\n        this.node_record.active = false;\r\n        this.node_record_detail.active = true;\r\n        if (dd.ui_manager.showLoading()) {\r\n            let obj = { 'tableId': tableId };\r\n            let msg = JSON.stringify(obj);\r\n            dd.ws_manager.sendMsg(dd.protocol.REPLAY_QUERY_DETAILED_RECORD, msg, (flag: number, content?: any) => {\r\n                if (flag === 0) {//成功\r\n                    this.showRecordDetailed(content as RecordDetailedVo);\r\n                } else if (flag === -1) {//超时\r\n                } else {//失败,content是一个字符串\r\n                    dd.ui_manager.showAlert(content, '温馨提示');\r\n                }\r\n                dd.ui_manager.hideLoading();\r\n                cc.log(content);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n    *  显示战绩记录信息\r\n    * \r\n    * @memberof Club\r\n    */\r\n    showRecordInfo(Records: RecordVo) {\r\n        this.svNode_record.content.removeAllChildren();\r\n        if (!Records) return;\r\n        if (Records.items) {\r\n            this.lblNoRecord.active = false;\r\n            for (var i = 0; i < Records.items.length; i++) {\r\n                let club_record_item = cc.instantiate(this.club_record_item_prefab);\r\n                let record_script = club_record_item.getComponent('Club_Record_Item');\r\n                record_script.updateItem(i + 1, Records.items[i], '0', (recordData: RecordItemVo) => {\r\n                    this.sendGetRecordDetailed(recordData.tableId);\r\n                }, this);\r\n                club_record_item.parent = this.svNode_record.content;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 显示详细战绩数据\r\n     * \r\n     * @param {RecordDetailedVo} data \r\n     * @memberof Record\r\n     */\r\n    showRecordDetailed(data: RecordDetailedVo) {\r\n        this.svNode_record_detail.content.removeAllChildren();\r\n        if (!data) return;\r\n        this.lblRoomId.string = '房间号:' + data.tableId;\r\n        for (var i = 0; i < data.nicks.length; i++) {\r\n            this.lblNameList[i].string = data.nicks[i];\r\n        }\r\n        if (data.items) {\r\n            for (var i = 0; i < data.items.length; i++) {\r\n                let record_detail_item = cc.instantiate(this.record_detail_item_prefab);\r\n                let record_detail_script = record_detail_item.getComponent('Record_Detail');\r\n                record_detail_script.updateItem(data.items[i], (recordData: RecordDetailedItemVo) => {\r\n                    this.sendGetVedio(recordData.recordFile);\r\n                }, this);\r\n                record_detail_item.parent = this.svNode_record_detail.content;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * 退出\r\n     * \r\n     * @memberof Record\r\n     */\r\n    click_btn_out() {\r\n        dd.mp_manager.playButton();\r\n        if (this.node_record.active) {\r\n            dd.ui_manager.isShowPopup = true;\r\n            this.node.removeFromParent(true);\r\n            this.node.destroy();\r\n        }\r\n        if (this.node_record_detail.active) {\r\n            this.sendGetRecord();\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 战绩录像数据获取接口\r\n     * \r\n     * @param {string} filName \r\n     * @memberof Record\r\n     */\r\n    sendGetVedio(filName: string) {\r\n        if (dd.ui_manager.showLoading()) {\r\n            let url = dd.config.replayUrl + filName;\r\n            cc.log(url);\r\n            fetch(url, {\r\n\r\n            }).then((response) => {\r\n                if (response.ok) {\r\n                    response.json().then((json) => {\r\n                        cc.log(JSON.stringify(json).length);\r\n                        dd.gm_manager.replayMJ = 1;\r\n                        dd.gm_manager.replayDataList = json.datas as ReplayData[];\r\n                        dd.gm_manager.mjGameData = dd.gm_manager.replayDataList[0].frameData;\r\n                        cc.director.loadScene('MJScene');\r\n                    });\r\n                } else {\r\n                    dd.ui_manager.showTip('获取录像失败');\r\n                    dd.ui_manager.hideLoading();\r\n                }\r\n            }).catch((errMsg) => {\r\n                cc.log(errMsg);\r\n                dd.ui_manager.showAlert('服务器响应失败，请确认您的网络通畅后，重试！', '温馨提示');\r\n                dd.ui_manager.hideLoading();\r\n            });\r\n        }\r\n    }\r\n}\r\n"]}