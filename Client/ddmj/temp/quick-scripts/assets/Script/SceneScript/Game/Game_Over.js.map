{"version":3,"sources":["Game_Over.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\SceneScript\\Game","sourcesContent":["const { ccclass, property } = cc._decorator;\r\nimport * as MJ_Help from './MJ_Help';\r\nimport * as dd from './../../Modules/ModuleManager';\r\n@ccclass\r\nexport default class Game_Over extends cc.Component {\r\n\r\n    /**\r\n     * 标题图片\r\n     * \r\n     * @type {cc.Sprite}\r\n     * @memberof Game_Over\r\n     */\r\n    @property(cc.Sprite)\r\n    imgTitle: cc.Sprite = null;\r\n\r\n    /**\r\n     * 标题描述\r\n     * \r\n     * @type {cc.Label}\r\n     * @memberof Game_Over\r\n     */\r\n    @property(cc.Label)\r\n    lbl_over_des: cc.Label = null;\r\n\r\n    /**\r\n     * 按钮名称\r\n     * \r\n     * @type {cc.Label}\r\n     * @memberof Game_Over\r\n     */\r\n    @property(cc.Label)\r\n    lblBtnName: cc.Label = null;\r\n    /**\r\n     * 单个人结算的预设\r\n     * \r\n     * @type {cc.Prefab}\r\n     * @memberof Game_Over\r\n     */\r\n    @property(cc.Prefab)\r\n    game_over_prefab: cc.Prefab = null;\r\n\r\n    /**\r\n     * 预设容器的父节点\r\n     * \r\n     * @type {cc.Node}\r\n     * @memberof Game_Over\r\n     */\r\n    @property(cc.ScrollView)\r\n    svNode: cc.ScrollView = null;\r\n\r\n    /**\r\n     * 标题图片列表\r\n     * \r\n     * @type {cc.SpriteFrame[]}\r\n     * @memberof Game_Over\r\n     */\r\n    @property([cc.SpriteFrame])\r\n    img_title_list: cc.SpriteFrame[] = [];\r\n\r\n    _canvasTarget = null;\r\n    onLoad() {\r\n        this.node.on(\"touchend\", (event: cc.Event.EventTouch) => {\r\n            event.stopPropagation();\r\n        }, this);\r\n        this._canvasTarget = dd.ui_manager.getCanvasNode().getComponent('MJCanvas');\r\n    }\r\n\r\n    /**\r\n     * 初始化数据\r\n     * \r\n     * @memberof Game_Over\r\n     */\r\n    initData(sov: SettlementOnceVo[]) {\r\n        if (!sov) return;\r\n        this.svNode.content.removeAllChildren();\r\n        let isLiuJu = true;\r\n        let mySeatInfo: SettlementOnceVo = null;\r\n        for (var i = 0; i < sov.length; i++) {\r\n            let goItem = cc.instantiate(this.game_over_prefab);\r\n            let goItemScript = goItem.getComponent('Game_Over_Item');\r\n            goItemScript.updateItem(i, sov[i]);\r\n            goItem.parent = this.svNode.content;\r\n            //如果有一家胡牌了，就不算流局\r\n            if (sov[i].huPaiIndex !== 0) {\r\n                isLiuJu = false;\r\n            }\r\n            if (sov[i].accountId === dd.ud_manager.mineData.accountId) {\r\n                mySeatInfo = sov[i];\r\n            }\r\n        }\r\n\r\n        if (isLiuJu) {\r\n            this.imgTitle.spriteFrame = this.img_title_list[2];\r\n        } else {\r\n            if (mySeatInfo && mySeatInfo.score >= 0) {\r\n                this.imgTitle.spriteFrame = this.img_title_list[0];\r\n            } else {\r\n                this.imgTitle.spriteFrame = this.img_title_list[1];\r\n            }\r\n        }\r\n        this.lblBtnName.string = dd.gm_manager.mjGameData.tableBaseVo.nextGame === 1 ? '下一局' : '查看结算';\r\n        this.lbl_over_des.string = dd.gm_manager.mjGameData.tableBaseVo.ruleShowDesc;\r\n        /********自动进入下一局 */\r\n        let outTime = MJ_Help.getDiffTime(dd.gm_manager.mjGameData.tableBaseVo.svrTime, dd.gm_manager.mjGameData.tableBaseVo.actTime);\r\n        outTime = (outTime - 1) * 1000;\r\n        setTimeout(() => {\r\n            if (this.node && this.node.isValid) {\r\n                dd.js_call_native.phoneVibration();\r\n            }\r\n        }, outTime);\r\n    }\r\n\r\n    /**\r\n     * 点击下一局游戏按钮\r\n     * \r\n     * @memberof Game_Over\r\n     */\r\n    click_btn_next() {\r\n        dd.mp_manager.playButton();\r\n        this.sendNextGame();\r\n    }\r\n\r\n    /**\r\n    * 发送下一局\r\n    * \r\n    * @param {number[]} cardIds \r\n    * @memberof MJCanvas\r\n    */\r\n    sendNextGame() {\r\n        if (dd.ui_manager.showLoading()) {\r\n            dd.ws_manager.sendMsg(dd.protocol.MAJIANG_ROOM_NEXT_GAME, '', (flag: number, content?: any) => {\r\n                if (flag === 0) {//成功\r\n                    dd.ui_manager.hideLoading();\r\n                    dd.gm_manager.mjGameData = content as MJGameData;\r\n                    this._canvasTarget.showMJInfo();\r\n                    this.node.removeFromParent(true);\r\n                    this.node.destroy();\r\n                } else if (flag === -1) {//超时\r\n                } else {//失败,content是一个字符串\r\n                    cc.log(content);\r\n                    dd.ui_manager.hideLoading();\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n"]}