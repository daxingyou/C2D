{"version":3,"sources":["MJ_Replay.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\SceneScript\\Game","sourcesContent":["\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nimport MJCanvas from './MJCanvas';\r\nimport * as MJ_Help from './MJ_Help';\r\nimport * as dd from './../../Modules/ModuleManager';\r\n@ccclass\r\nexport default class MJ_Replay extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    btn_pause: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    btn_play: cc.Node = null;\r\n\r\n    /**\r\n     * canvas脚本\r\n     * \r\n     * @memberof MJ_Table\r\n     */\r\n    _canvasTarget: MJCanvas = null;\r\n\r\n    /**\r\n     * 帧时间\r\n     * \r\n     * @type {number}\r\n     * @memberof MJ_Replay\r\n     */\r\n    _frameTime: number = 0;\r\n\r\n    /**\r\n     * 数据索引\r\n     * \r\n     * @type {number}\r\n     * @memberof MJ_Replay\r\n     */\r\n    _replayIndex: number = 0;\r\n\r\n    onLoad() {\r\n        this._canvasTarget = dd.ui_manager.getCanvasNode().getComponent('MJCanvas');\r\n        this.node.on(\"touchend\", (event: cc.Event.EventTouch) => {\r\n            event.stopPropagation();\r\n        }, this);\r\n\r\n        //如果是重播，就先暂停所有的刷新\r\n        if (dd.gm_manager.replayMJ === 1) {\r\n            dd.gm_manager.isReplayPause = true;\r\n            this.btn_pause.active = false;\r\n            this.btn_play.active = true;\r\n            this._replayIndex = 0;\r\n            this.showReplayInfo();\r\n        } else {\r\n            dd.gm_manager.isReplayPause = false;\r\n        }\r\n    }\r\n\r\n    update(dt) {\r\n        if (!dd.gm_manager.isReplayPause) {\r\n            if (this._frameTime >= 0) {\r\n                this._frameTime -= dt;\r\n                if (this._frameTime <= 0) {\r\n                    this._replayIndex++;\r\n                    this.showReplayInfo();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置播放游戏记录的数据\r\n     * \r\n     * @memberof MJ_Replay\r\n     */\r\n    showReplayInfo() {\r\n        if (this._replayIndex > dd.gm_manager.replayDataList.length - 1) {\r\n            dd.gm_manager.isReplayPause = true;\r\n            this.btn_pause.active = false;\r\n            this.btn_play.active = true;\r\n            this._replayIndex = dd.gm_manager.replayDataList.length;\r\n\r\n            dd.ui_manager.showAlert('游戏记录播放完毕,是否重新播放？'\r\n                , '温馨提示',\r\n                {\r\n                    lbl_name: '确定',\r\n                    callback: () => {\r\n                        //移除结算面板\r\n                        if (this._canvasTarget._game_over && this._canvasTarget._game_over.isValid) {\r\n                            this._canvasTarget._game_over.removeFromParent(true);\r\n                            this._canvasTarget._game_over.destroy();\r\n                        }\r\n                        this._replayIndex = 0;\r\n                        this.showReplayInfo();\r\n                    }\r\n                },\r\n                {\r\n                    lbl_name: '退出',\r\n                    callback: () => {\r\n                        if (dd.ui_manager.showLoading()) {\r\n                            cc.director.loadScene('HomeScene', () => {\r\n                                let canvasScript = dd.ui_manager.getCanvasNode().getComponent('HomeCanvas');\r\n                                if (canvasScript) {\r\n                                    canvasScript.showRecord(dd.gm_manager.mjGameData.tableBaseVo.tableId);\r\n                                }\r\n                                dd.gm_manager.destroySelf();\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n                , 1);\r\n            return;\r\n        }\r\n        let nowReplay = dd.gm_manager.replayDataList[this._replayIndex];\r\n        dd.gm_manager.mjGameData = nowReplay.frameData;\r\n        if (this._replayIndex + 1 < dd.gm_manager.replayDataList.length) {\r\n            let nextReplay = dd.gm_manager.replayDataList[this._replayIndex + 1];\r\n            let ft = MJ_Help.getDiffTime(nowReplay.startTime, nextReplay.startTime);\r\n            this._frameTime = (Number(nextReplay.startTime) - Number(nowReplay.startTime)) / 1000;\r\n        }\r\n        this._canvasTarget.showMJInfo();\r\n    }\r\n\r\n    /**\r\n     * 回放按钮点击事件\r\n     * \r\n     * @param {any} event \r\n     * @param {string} type \r\n     * @memberof MJ_Table\r\n     */\r\n    click_btn_replay(event, type: string) {\r\n        dd.mp_manager.playButton();\r\n        switch (type) {\r\n            case '0'://退出\r\n                dd.ui_manager.showAlert('您确定退出播放战绩吗？'\r\n                    , '温馨提示',\r\n                    {\r\n                        lbl_name: '确定',\r\n                        callback: () => {\r\n                            if (dd.ui_manager.showLoading()) {\r\n                                cc.director.loadScene('HomeScene', () => {\r\n                                    let canvasScript = dd.ui_manager.getCanvasNode().getComponent('HomeCanvas');\r\n                                    if (canvasScript) {\r\n                                        canvasScript.showRecord(dd.gm_manager.mjGameData.tableBaseVo.tableId);\r\n                                    }\r\n                                    dd.gm_manager.destroySelf();\r\n                                });\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        lbl_name: '取消',\r\n                        callback: () => {\r\n                        }\r\n                    }\r\n                    , 1);\r\n\r\n                break;\r\n            case '1'://播放\r\n                dd.gm_manager.isReplayPause = false;\r\n                this.btn_pause.active = true;\r\n                this.btn_play.active = false;\r\n                break;\r\n            case '2'://暂停\r\n                dd.gm_manager.isReplayPause = true;\r\n                this.btn_pause.active = false;\r\n                this.btn_play.active = true;\r\n                break;\r\n            case '3'://进\r\n                this._replayIndex++;\r\n                this.showReplayInfo();\r\n                dd.gm_manager.isReplayPause = true;\r\n                this.btn_pause.active = false;\r\n                this.btn_play.active = true;\r\n                break;\r\n            case '4'://退\r\n                if (this._replayIndex > 0) {\r\n                    this._replayIndex--;\r\n                }\r\n                this.showReplayInfo();\r\n                dd.gm_manager.isReplayPause = true;\r\n                this.btn_pause.active = false;\r\n                this.btn_play.active = true;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n}\r\n"]}