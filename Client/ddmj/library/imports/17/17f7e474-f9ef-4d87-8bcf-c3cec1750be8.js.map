{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\SceneScript\\Home/assets\\Script\\SceneScript\\Home\\Mail.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\SceneScript\\Home","sourcesContent":["const { ccclass, property } = cc._decorator;\r\nimport * as dd from './../../Modules/ModuleManager';\r\nimport mail_item from './Mail_Item';\r\n@ccclass\r\nexport default class Email extends cc.Component {\r\n\r\n    /**\r\n     * 列表容器\r\n     * \r\n     * @type {cc.ScrollView}\r\n     * @memberof Email\r\n     */\r\n    @property(cc.ScrollView)\r\n    svNode: cc.ScrollView = null;\r\n\r\n    /**\r\n     * 没有邮件时显示的节点\r\n     * \r\n     * @type {cc.Node}\r\n     * @memberof Email\r\n     */\r\n    @property(cc.Node)\r\n    lblNoMail: cc.Node = null;\r\n\r\n    /**\r\n     * 邮件的item预设\r\n     * \r\n     * @type {cc.Prefab}\r\n     * @memberof Email\r\n     */\r\n    @property(cc.Prefab)\r\n    mail_item_prefab: cc.Prefab = null;\r\n    /**\r\n     * 邮件列表数据\r\n     * \r\n     * @type {MailVo[]}\r\n     * @memberof Email\r\n     */\r\n    _mailList: MailVo[] = [];\r\n    onLoad() {\r\n        this.node.on(\"touchend\", (event: cc.Event.EventTouch) => {\r\n            dd.ui_manager.isShowPopup = true;\r\n            this.node.removeFromParent(true);\r\n            this.node.destroy();\r\n            event.stopPropagation();\r\n        }, this);\r\n\r\n        // let obj = {};\r\n        // let msg = JSON.stringify(obj);\r\n        dd.ws_manager.sendMsg(dd.protocol.MAIL_MAILLIST, '', (flag: number, content?: any) => {\r\n            if (flag === 0) {//成功\r\n                this._mailList = content as MailVo[];\r\n                this.showMailInfo();\r\n            } else if (flag === -1) {//超时\r\n            } else {//失败,content是一个字符串\r\n                cc.log(content);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 读取邮件\r\n     * \r\n     * @param {number} mailId \r\n     * @memberof Email\r\n     */\r\n    readMail(mailId: number) {\r\n        let obj = { mailId: mailId };\r\n        let msg = JSON.stringify(obj);\r\n        dd.ws_manager.sendMsg(dd.protocol.MAIL_MAILVIEW, msg, (flag: number, content?: any) => {\r\n            if (flag === 0) {//成功\r\n                this._mailList = content as MailVo[];\r\n            } else if (flag === -1) {//超时\r\n            } else {//失败,content是一个字符串\r\n                cc.log(content);\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * 显示邮件列表信息\r\n     * \r\n     * @memberof Email\r\n     */\r\n    showMailInfo(): void {\r\n        if (this._mailList) {\r\n            this.svNode.node.active = true;\r\n            this.lblNoMail.active = false;\r\n\r\n            this.svNode.content.removeAllChildren();\r\n            for (var i = 0; i < this._mailList.length; i++) {\r\n                this.createMailItem(i, this._mailList[i]);\r\n            }\r\n        } else {\r\n            this.svNode.node.active = false;\r\n            this.lblNoMail.active = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 创建邮件item\r\n     * \r\n     * @memberof Email\r\n     */\r\n    createMailItem(index: number, data: MailVo) {\r\n        let mail_item = cc.instantiate(this.mail_item_prefab);\r\n        let mail_item_script: mail_item = mail_item.getComponent('Mail_Item');\r\n        mail_item_script.updateItem(index, data, (itemData: MailVo) => {\r\n            this.readMail(itemData.mailId);\r\n            let str = '   ' + itemData.content + '<br/>    ' + dd.utils.getDateStringByTimestamp(itemData.recvTime, 3);\r\n            dd.ui_manager.showAlert(str, itemData.title, {\r\n                lbl_name: '确定',\r\n                callback: () => {\r\n                    this.showMailInfo();\r\n                }\r\n            }, null, 0);\r\n        });\r\n        mail_item.parent = this.svNode.content;\r\n    }\r\n    /**\r\n     * 退出\r\n     * \r\n     * @memberof Email\r\n     */\r\n    click_btn_out() {\r\n        dd.mp_manager.playButton();\r\n        dd.ui_manager.isShowPopup = true;\r\n        this.node.removeFromParent(true);\r\n        this.node.destroy();\r\n    }\r\n}\r\n"]}