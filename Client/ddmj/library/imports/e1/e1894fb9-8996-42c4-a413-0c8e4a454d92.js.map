{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\SceneScript\\Game/assets\\Script\\SceneScript\\Game\\Game_Disband.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\SceneScript\\Game","sourcesContent":["\r\nimport * as dd from './../../Modules/ModuleManager';\r\nconst { ccclass, property } = cc._decorator;\r\nimport MJCanvas from './MJCanvas';\r\nimport * as MJ_Help from './MJ_Help';\r\n\r\n@ccclass\r\nexport default class Game_Disband extends cc.Component {\r\n\r\n    /**\r\n     * 解散房间的描述\r\n     * \r\n     * @type {cc.Label}\r\n     * @memberof Game_Disband\r\n     */\r\n    @property(cc.Label)\r\n    lblDes: cc.Label = null;\r\n\r\n    /**\r\n     * 解散房间的提示\r\n     * \r\n     * @type {cc.Label}\r\n     * @memberof Game_Disband\r\n     */\r\n    @property(cc.Label)\r\n    lblTip: cc.Label = null;\r\n\r\n    /**\r\n     * 玩家名字列表\r\n     * \r\n     * @type {cc.Label[]}\r\n     * @memberof Game_Disband\r\n     */\r\n    @property(cc.Label)\r\n    lblNameList: cc.Label[] = [];\r\n\r\n    /**\r\n     * 头像列表\r\n     * \r\n     * @type {cc.Sprite[]}\r\n     * @memberof Game_Disband\r\n     */\r\n    @property(cc.Sprite)\r\n    headImgList: cc.Sprite[] = [];\r\n    /**\r\n     * 玩家的表态列表\r\n     * \r\n     * @type {[cc.Sprite]}\r\n     * @memberof Game_Disband\r\n     */\r\n    @property([cc.Sprite])\r\n    stateList: cc.Sprite[] = [];\r\n\r\n    /**\r\n     * 玩家的表态图片列表\r\n     * \r\n     * @type {[cc.SpriteFrame]} 0=同意 1=拒绝 2=等待\r\n     * @memberof Game_Disband\r\n     */\r\n    @property([cc.SpriteFrame])\r\n    stateImgList: cc.SpriteFrame[] = [];\r\n    /**\r\n     * 解散房间倒计时\r\n     * \r\n     * @type {cc.Label}\r\n     * @memberof Game_Disband\r\n     */\r\n    @property(cc.Label)\r\n    lblTime: cc.Label = null;\r\n\r\n    /**\r\n     * 确定按钮\r\n     * \r\n     * @type {cc.Node}\r\n     * @memberof Game_Disband\r\n     */\r\n    @property(cc.Node)\r\n    btn_ok: cc.Node = null;\r\n\r\n    /**\r\n     * \r\n     * 拒绝按钮\r\n     * @type {cc.Node}\r\n     * @memberof Game_Disband\r\n     */\r\n    @property(cc.Node)\r\n    btn_refuse: cc.Node = null;  //拒绝\r\n\r\n    /**\r\n     * 倒计时的cd\r\n     * \r\n     * @type {number}\r\n     * @memberof Game_Disband\r\n     */\r\n    _cd: number = 1;\r\n    /**\r\n     * 倒计时\r\n     * \r\n     * @type {number}\r\n     * @memberof Game_Disband\r\n     */\r\n    _downTime: number = 3;\r\n\r\n    /**\r\n     * canvas脚本\r\n     * \r\n     * @memberof MJ_Table\r\n     */\r\n    _canvasTarget: MJCanvas = null;\r\n\r\n    /**\r\n     * 房间信息获取时间\r\n     * \r\n     * @type {number}\r\n     * @memberof Game_Disband\r\n     */\r\n    _rTime: number = 10;\r\n\r\n    onLoad() {\r\n        this._canvasTarget = dd.ui_manager.getCanvasNode().getComponent('MJCanvas');\r\n        this.node.on(\"touchend\", (event: cc.Event.EventTouch) => {\r\n            event.stopPropagation();\r\n        }, this);\r\n    }\r\n\r\n    initData() {\r\n        let creatorSeat = MJ_Help.getSeatById(dd.gm_manager.mjGameData.tableBaseVo.destoryQuestPlayer);\r\n        this.lblDes.string = '玩家【' + creatorSeat.nick + '】申请解散房间，是否同意？';\r\n        this._downTime = MJ_Help.getDiffTime(dd.gm_manager.mjGameData.tableBaseVo.svrTime, dd.gm_manager.mjGameData.tableBaseVo.actTime);\r\n        this.lblTime.string = '倒计时' + this._downTime + 's';\r\n\r\n        let btSeats: SeatVo[] = [];\r\n        let seats = dd.gm_manager.mjGameData.seats;\r\n        for (var i = 0; i < seats.length; i++) {\r\n            if (seats[i] && seats[i].accountId !== '0') {\r\n                //如果这个玩家不是房主\r\n                if (seats[i].accountId !== dd.gm_manager.mjGameData.tableBaseVo.destoryQuestPlayer) {\r\n                    btSeats.push(seats[i]);\r\n                }\r\n                //如果是自己，查看自己是否表态了，要不要显示表态那妞\r\n                if (seats[i].accountId === dd.ud_manager.mineData.accountId) {\r\n                    if (seats[i].btState !== MJ_Help.MJ_Act_State.ACT_STATE_WAIT) {\r\n                        this.btn_ok.active = false;\r\n                        this.btn_refuse.active = false;\r\n                    } else {\r\n                        this.btn_ok.active = true;\r\n                        this.btn_refuse.active = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        for (var i = 0; i < btSeats.length; i++) {\r\n            let state = this.stateList[i];\r\n            state.node.stopAllActions();\r\n            state.node.rotation = 0;\r\n            //如果座位状态已经表态了\r\n            if (btSeats[i].btState !== MJ_Help.MJ_Act_State.ACT_STATE_WAIT) {\r\n                state.spriteFrame = btSeats[i].btState === 1 ? this.stateImgList[0] : this.stateImgList[1];\r\n            } else {\r\n                state.spriteFrame = this.stateImgList[2];\r\n                let action = cc.repeatForever(cc.sequence(cc.rotateTo(1, 180), cc.rotateTo(1, 360)));\r\n                state.node.runAction(action);\r\n            }\r\n            this.lblNameList[i].string = btSeats[i].nick;\r\n            this.showHead(i, btSeats[i].headImg);\r\n        }\r\n    }\r\n\r\n    async showHead(index: number, sf: string) {\r\n        //刷新玩家信息\r\n        let headSF = null;\r\n        try {\r\n            headSF = await dd.img_manager.loadURLImage(sf);\r\n        } catch (error) {\r\n            cc.log('获取头像错误');\r\n        }\r\n        if (this.headImgList[index]) {\r\n            this.headImgList[index].spriteFrame = headSF;\r\n        }\r\n    }\r\n    /**\r\n     * 点击确定\r\n     * \r\n     * @memberof Game_Disband\r\n     */\r\n    click_btn_ok() {\r\n        dd.mp_manager.playButton();\r\n        this._canvasTarget.sendDisband(2);\r\n    }\r\n\r\n    /**\r\n     * 点击拒绝\r\n     * \r\n     * @memberof Game_Disband\r\n     */\r\n    click_btn_refuse() {\r\n        dd.mp_manager.playButton();\r\n        this._canvasTarget.sendDisband(1);\r\n    }\r\n\r\n    /**\r\n     * 获取游戏房间信息，这里用于判断玩家在 房主放出解散房间的请求后，玩家是否已经退出房间，还是数据丢包\r\n     * \r\n     * @memberof Game_Disband\r\n     */\r\n    sendGetGameInfo() {\r\n        let obj = { 'tableId': Number(dd.gm_manager.mjGameData.tableBaseVo.tableId) };\r\n        let msg = JSON.stringify(obj);\r\n        dd.ws_manager.sendMsg(dd.protocol.MAJIANG_ROOM_JOIN, msg, (flag: number, content?: any) => {\r\n            cc.log('flag=' + flag + ';content=' + content);\r\n            if (flag === 0) {//成功\r\n            } else if (flag === -1) {//超时\r\n            } else {//失败,content是一个字符串\r\n                this._canvasTarget.quitGame();\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * 界面刷新\r\n     * \r\n     * @param {number} dt \r\n     * @memberof Game_Disband\r\n     */\r\n    update(dt: number) {\r\n        if (this._downTime > 0) {\r\n            this._cd -= dt;\r\n            if (this._cd <= 0) {\r\n                this._cd = 1;\r\n                this._downTime--;\r\n                this.lblTime.string = '倒计时' + this._downTime + 's';\r\n                if (this._downTime <= 0) {\r\n                    cc.log('结束倒计时');\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!this.btn_ok.active) {\r\n            this._rTime -= dt;\r\n            if (this._rTime < 0) {\r\n                this._rTime = 10;\r\n                this.sendGetGameInfo();\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}