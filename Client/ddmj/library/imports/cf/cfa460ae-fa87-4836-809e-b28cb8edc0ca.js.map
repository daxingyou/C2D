{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\SceneScript\\Game/assets\\Script\\SceneScript\\Game\\Game_Result.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\SceneScript\\Game","sourcesContent":["const { ccclass, property } = cc._decorator;\r\nimport * as dd from './../../Modules/ModuleManager';\r\n@ccclass\r\nexport default class Game_Result extends cc.Component {\r\n\r\n    /**\r\n     * 单个人结算的预设\r\n     * \r\n     * @type {cc.Prefab}\r\n     * @memberof Game_Result\r\n     */\r\n    @property(cc.Prefab)\r\n    game_result_prefab: cc.Prefab = null;\r\n\r\n    /**\r\n     * 预设容器的父节点\r\n     * \r\n     * @type {cc.Node}\r\n     * @memberof Game_Result\r\n     */\r\n    @property(cc.Node)\r\n    listLayout: cc.Node = null;\r\n    /**\r\n     * 微信分享 按钮\r\n     * @type {cc.Node}\r\n     * @memberof MJ_Table\r\n     */\r\n    @property(cc.Node)\r\n    node_wx_share: cc.Node = null;\r\n    /**\r\n     * 是否点击按钮\r\n     * \r\n     * @type {boolean}\r\n     * @memberof Game_Result\r\n     */\r\n    _isTouch: boolean = false;\r\n\r\n    /**\r\n    * 微信分享回调\r\n    * \r\n    * @memberof MJ_Table\r\n    */\r\n    wxShareCallBack = (event: cc.Event.EventCustom) => {\r\n        let data = event.detail;\r\n        if (data === 0) {\r\n            dd.ui_manager.showTip('战绩分享成功！');\r\n        } else {\r\n            dd.ui_manager.showTip('战绩分享失败！');\r\n        }\r\n    };\r\n    onLoad() {\r\n        dd.ui_manager.fixIPoneX(this.node);\r\n        this.node.on(\"touchend\", (event: cc.Event.EventTouch) => {\r\n            event.stopPropagation();\r\n        }, this);\r\n\r\n        if (dd.config.wxState === 0) {\r\n            this.node_wx_share.active = true;\r\n        } else {\r\n            this.node_wx_share.active = false;\r\n        }\r\n\r\n        this.showGameResult();\r\n        cc.systemEvent.on('cb_share', this.wxShareCallBack, this);\r\n    }\r\n    onDestroy() {\r\n        cc.systemEvent.off('cb_share', this.wxShareCallBack, this);\r\n    }\r\n\r\n    /**\r\n     * 初始化数据\r\n     * \r\n     * @memberof Game_Result\r\n     */\r\n    showGameResult() {\r\n        if (dd.gm_manager && dd.gm_manager.mjGameData && dd.gm_manager.mjGameData.settlementAll) {\r\n            let sav = dd.gm_manager.mjGameData.settlementAll;\r\n            let maxScore = sav[0].score;\r\n            let maxDP = sav[0].dianPao;\r\n            for (var i = 1; i < sav.length; i++) {\r\n                if (sav[i].score > maxScore) {\r\n                    maxScore = sav[i].score;\r\n                }\r\n                if (sav[i].dianPao > maxDP) {\r\n                    maxDP = sav[i].dianPao;\r\n                }\r\n            }\r\n            this.listLayout.removeAllChildren();\r\n            for (var i = 0; i < sav.length; i++) {\r\n                let rsItem = cc.instantiate(this.game_result_prefab);\r\n                let rsItemScript = rsItem.getComponent('Game_Result_Item');\r\n                rsItemScript.updateItem(sav[i], maxScore, maxDP);\r\n                rsItem.parent = this.listLayout;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 点击退出按钮\r\n     * \r\n     * @memberof Game_Result\r\n     */\r\n    click_btn_out() {\r\n        if (this._isTouch) {\r\n            return;\r\n        }\r\n        dd.mp_manager.playButton();\r\n        if (dd.ui_manager.showLoading()) {\r\n            dd.ud_manager.mineData.tableId = 0;\r\n            if (dd.gm_manager.mjGameData.tableBaseVo.corpsId !== '0') {\r\n                cc.director.loadScene('ClubScene', () => {\r\n                    dd.gm_manager.destroySelf();\r\n                    cc.sys.garbageCollect();\r\n                });\r\n            } else {\r\n                cc.director.loadScene('HomeScene', () => {\r\n                    dd.gm_manager.destroySelf();\r\n                    cc.sys.garbageCollect();\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 点击分享按钮\r\n     * \r\n     * @memberof Game_Result\r\n     */\r\n    click_btn_share() {\r\n        if (this._isTouch) {\r\n            return;\r\n        }\r\n        this._isTouch = true;\r\n        dd.mp_manager.playButton();\r\n        dd.utils.captureScreen(this.node, 'jt.png', (filePath) => {\r\n            if (filePath) {\r\n                dd.js_call_native.wxShareRecord(filePath);\r\n                this._isTouch = false;\r\n            } else {\r\n                dd.ui_manager.showTip('截图失败!');\r\n                this._isTouch = false;\r\n            }\r\n            dd.ui_manager.hideLoading();\r\n        });\r\n    }\r\n}\r\n"]}